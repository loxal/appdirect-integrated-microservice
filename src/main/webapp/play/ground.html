<!DOCTYPE html>
<!--
  ~ Copyright 2015 Alexander Orlov <alexander.orlov@loxal.net>. All rights reserved.
  -->

<meta charset="UTF-8">
<title>Playground</title>

<script>
    "use strict";
    var openIdSignInTrigger = document.getElementById("openIdSignInTrigger");
    var openIdAuthenticated;

    function openIdSignIn() {
        var load = function () {
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function () {
                console.log(xhr.readyState);
                if (xhr.readyState == 4 && xhr.status == 200) {
                    var openIdInfo = JSON.parse(xhr.response);
                    console.log("ok");
                } else {
                    console.log("failed");
                    console.log(openIdAuthenticated);
                }
            };
            xhr.open("GET", openIdAuthenticated, true);
            xhr.send();
        };
        load();
    }

    function main() {
        var configure = function () {
            var openIdSignInLink = document.getElementById("openIdSignInLink");
        };

        var load = function () {
            var origin = document.location.origin;
            var openIdSignInUrl = origin + "/authentication/openid?url=https://www.appdirect.com/openid/id&returnToUrl=" + origin + "/play/ground.html";
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    var openIdInfo = JSON.parse(xhr.response);
                    openIdSignInLink.href = openIdInfo.signInUrl;
                    openIdAuthenticated = openIdInfo.signInUrl;
                }
            };
            xhr.open("GET", openIdSignInUrl, true);
            xhr.send();
        };

        configure();
        load();
        var showOpenIdInfo = function () {
            var openIdInfo = document.getElementById("openIdInfo");
            if (document.location.search === "") {
                openIdInfo.textContent = "Not Authenticated";
            } else {
                openIdInfo.textContent = document.location.search;
            }
        };
        showOpenIdInfo();
    }
</script>

<body onload="main()">
<h1>Playground</h1>

<h2>Authentication</h2>
<ul>
    <li>
        <a id="openIdSignInLink">
            Sign-in with AppDirect, using OpenID 2.0
        </a>
    </li>
    <!--<li>-->
    <!--<button id="openIdSignInTrigger" onclick="openIdSignIn()">-->
    <!--Sign-in with AppDirect, using OpenID 2.0-->
    <!--</button>-->
    <!--</li>-->
</ul>
<div id="openIdInfo"></div>
</body>
